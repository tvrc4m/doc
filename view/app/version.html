<div class="col-md-9" style="padding-right:15px;width: 100%;">
    <h2>版本号管理</h2>
    <table class="table table-bordered table-striped">
        <thead>
            <tr class="warning">
                <th width="110">名称</th>
                <th width="110">操作</th>
            </tr>
        </thead>
        <tbody>
            <?php foreach($data['version_list'] as $version){?>
                <tr>
                   <td><?php echo $version['name'];?></td> 
                   <td>
                       <code><a class="version-del" onclick="delVersion(this)" data-id="<?php echo $version['id'];?>">删除</a></code>
                   </td>
                </tr>
            <?php } ?>
        </tbody>
    </table>
</div>

<script src="/static/js/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
    function editVersion(that){
        var name=$(that).data('name');
        var id=$(that).data('id');
        console.log(name);
        $("#version_modal input[name=name]").val(name);
        $("#version_modal input[name=id]").val(id);
        document.getElementById("versionBtnSave").removeEventListener('click',add,false);
        document.getElementById("versionBtnSave").addEventListener('click',edit,false);
        modal('#version_modal');
    }
    function addVersion(){
        $("#version_modal input[name=name]").val('');
        $("#version_modal input[name=id]").val('');
        document.getElementById("versionBtnSave").removeEventListener('click',edit,false);
        document.getElementById("versionBtnSave").addEventListener('click',add,false);
        modal('#version_modal');
    }
    function delVersion(that){
        var id=$(that).data("id");
        if(!id) alert("未指定类别");
        if(window.confirm("只有未关联的接口可删除?")){
            $.ajax({
                url:"/api/version/del",
                type:"POST",
                dataType:"json",
                data:{id:id},
                success:function(data){
                    if(data.errno==0){
                        $(that).parents("tr").remove();
                    }else{
                        alert(data.errmsg);
                    }
                }
            })
        }
    }
    function add(){
        var name=$("#version_modal input[name=name]").val();
        var type=$("#version_modal input[name=type]").val();
        $.ajax({
            url:"/api/version/add",
            type:"POST",
            dataType:"json",
            data:{name:name,type:type},
            success:function(data){
                if(data.errno==0){
                    document.location.reload();
                }else{
                    alert(data.errmsg);
                }
            }
        })
    }
    function edit(){
        var name=$("#version_modal input[name=name]").val();
        var id=$("#version_modal input[name=id]").val();
        $.ajax({
            url:"/api/version/edit",
            type:"POST",
            dataType:"json",
            data:{name:name,id:id},
            success:function(data){
                if(data.errno==0){
                    document.location.reload();
                }else{
                    alert(data.errmsg);
                }
            }
        })
    }
    function modal(content){
        $.fancybox({
            'padding': 20,
            'autoSize': true,
            'overlayShow':true,
            'overlayOpacity':0.7,
           // 'autoHeight': true,
            'type': 'inline',
            'scrolling': 'no',
            'href': content
        });
    }
</script>